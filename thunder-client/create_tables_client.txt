;  
DROP ALL OBJECTS;           
CREATE USER IF NOT EXISTS "" SALT '' HASH '' ADMIN;           
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_AC49EEA8_75CE_4FC1_B41A_360FEF0C02EE START WITH 15 BELONGS_TO_TABLE;   
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_D9CE48D0_A379_49B1_94D5_16348BBD48A6 START WITH 1 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_34D0AF49_C467_4FF4_AEDB_E8B6D11E2F1B START WITH 1 BELONGS_TO_TABLE;    
CREATE SEQUENCE PUBLIC.SYSTEM_SEQUENCE_2BDD19A5_AB2A_4EE9_80C6_CAC11CB06099 START WITH 15 BELONGS_TO_TABLE;   
CREATE CACHED TABLE PUBLIC.CHANNELS(
    PUB_KEY_CLIENT VARCHAR(500) DEFAULT NULL,
    PUB_KEY_SERVER VARCHAR(500) DEFAULT NULL,
    CHANGE_ADDRESS_SERVER VARCHAR(500) DEFAULT NULL,
    CHANGE_ADDRESS_CLIENT VARCHAR(500) DEFAULT NULL,
    MASTER_PRIV_KEY_CLIENT VARCHAR(500) DEFAULT NULL,
    MASTER_PRIV_KEY_SERVER VARCHAR(500) DEFAULT NULL,
    INITIAL_AMOUNT_SERVER BIGINT DEFAULT NULL,
    INITIAL_AMOUNT_CLIENT BIGINT DEFAULT NULL,
    AMOUNT_SERVER BIGINT DEFAULT NULL,
    AMOUNT_CLIENT BIGINT DEFAULT NULL,
    TIMESTAMP_OPEN INT DEFAULT NULL,
    TIMESTAMP_CLOSE INT DEFAULT NULL,
    KEY_CHAIN_DEPTH INT DEFAULT NULL,
    KEY_CHAIN_CHILD INT DEFAULT NULL,
    MASTER_CHAIN_DEPTH INT DEFAULT NULL,
    OPENING_TX_HASH VARCHAR(500) DEFAULT NULL,
    OPENING_TX INT DEFAULT NULL,
    REFUND_TX_SERVER INT DEFAULT NULL,
    REFUND_TX_CLIENT INT DEFAULT NULL,
    CHANNEL_TX_SERVER INT DEFAULT NULL,
    CHANNEL_TX_REVOKE_SERVER INT DEFAULT NULL,
    CHANNEL_TX_CLIENT INT DEFAULT NULL,
    CHANNEL_TX_REVOKE_CLIENT INT DEFAULT NULL,
    CHANNEL_TX_SERVER_TEMP INT DEFAULT NULL,
    CHANNEL_TX_CLIENT_TEMP INT DEFAULT NULL,
    CHANNEL_TX_REVOKE_CLIENT_TEMP INT DEFAULT NULL,
    CHANNEL_TX_REVOKE_SERVER_TEMP INT DEFAULT NULL,
    HAS_OPEN_PAYMENTS TINYINT DEFAULT NULL,
    ESTABLISH_PHASE TINYINT DEFAULT NULL,
    PAYMENT_PHASE TINYINT DEFAULT NULL,
    IS_READY TINYINT DEFAULT NULL
);           
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.CHANNELS;
-- 8 +/- SELECT COUNT(*) FROM PUBLIC.CONSTANTS;               
INSERT INTO PUBLIC.CONSTANTS(KEY_COUNT) VALUES
(9);
CREATE CACHED TABLE PUBLIC.MESSAGES(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_AC49EEA8_75CE_4FC1_B41A_360FEF0C02EE) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_AC49EEA8_75CE_4FC1_B41A_360FEF0C02EE,
    TYPE TEXT NOT NULL,
    MESSAGE LONGTEXT NOT NULL,
    TIMESTAMP INT NOT NULL,
    PUBKEY VARCHAR(100) NOT NULL,
    SIGNATURE VARCHAR(100) NOT NULL
);        
ALTER TABLE PUBLIC.MESSAGES ADD CONSTRAINT PUBLIC.CONSTRAINT_1 PRIMARY KEY(ID);               
-- 6 +/- SELECT COUNT(*) FROM PUBLIC.MESSAGES;
CREATE CACHED TABLE PUBLIC.OUTPUTS(
    TRANSACTION_HASH VARCHAR(100) DEFAULT NULL,
    VOUT INT DEFAULT NULL,
    VALUE BIGINT DEFAULT NULL,
    PRIVATE_KEY VARCHAR(100) DEFAULT NULL,
    TRANSACTION_OUTPUT VARCHAR(100) DEFAULT NULL,
    TIMESTAMP_LOCKED INT DEFAULT NULL,
    CHANNEL_PUBKEY VARCHAR(100) DEFAULT NULL
);     
-- 35 +/- SELECT COUNT(*) FROM PUBLIC.OUTPUTS;
CREATE CACHED TABLE PUBLIC.PAYMENTS(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_D9CE48D0_A379_49B1_94D5_16348BBD48A6) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_D9CE48D0_A379_49B1_94D5_16348BBD48A6,
    PUB_KEY_SENDER VARCHAR(500) DEFAULT NULL,
    PUB_KEY_RECEIVER VARCHAR(500) NOT NULL,
    AMOUNT BIGINT NOT NULL,
    PHASE TINYINT NOT NULL,
    INCLUDE_IN_SENDER_CHANNEL TINYINT NOT NULL,
    INCLUDE_IN_RECEIVER_CHANNEL TINYINT NOT NULL,
    SECRET_HASH VARCHAR(500) NOT NULL,
    SECRET VARCHAR(500) DEFAULT NULL,
    SETTLEMENT_TX_SENDER INT DEFAULT NULL,
    SETTLEMENT_TX_SENDER_TEMP INT DEFAULT NULL,
    REFUND_TX_SENDER INT DEFAULT NULL,
    REFUND_TX_SENDER_TEMP INT DEFAULT NULL,
    ADD_TX_SENDER INT DEFAULT NULL,
    ADD_TX_SENDER_TEMP INT DEFAULT NULL,
    SETTLEMENT_TX_RECEIVER INT DEFAULT NULL,
    SETTLEMENT_TX_RECEIVER_TEMP INT DEFAULT NULL,
    REFUND_TX_RECEIVER INT DEFAULT NULL,
    REFUND_TX_RECEIVER_TEMP INT DEFAULT NULL,
    ADD_TX_RECEIVER INT DEFAULT NULL,
    ADD_TX_RECEIVER_TEMP INT DEFAULT NULL,
    TIMESTAMP_CREATED INT NOT NULL,
    TIMESTAMP_ADDED_TO_RECEIVER INT NOT NULL,
    TIMESTAMP_SETTLED INT NOT NULL
);       
ALTER TABLE PUBLIC.PAYMENTS ADD CONSTRAINT PUBLIC.CONSTRAINT_8 PRIMARY KEY(ID);               
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PAYMENTS;
CREATE CACHED TABLE PUBLIC.STOREDKEYS(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_34D0AF49_C467_4FF4_AEDB_E8B6D11E2F1B) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_34D0AF49_C467_4FF4_AEDB_E8B6D11E2F1B,
    CHANNEL_PUB_KEY VARCHAR(60) DEFAULT NULL,
    OWNER TINYINT DEFAULT NULL,
    PUB_KEY VARCHAR(60) NOT NULL,
    PRIV_KEY VARCHAR(60) DEFAULT NULL,
    CURRENT_CHANNEL TINYINT DEFAULT NULL,
    USED TINYINT DEFAULT NULL,
    EXPOSED TINYINT DEFAULT NULL,
    KEY_CHAIN_DEPTH INT DEFAULT NULL,
    KEY_CHAIN_CHILD INT DEFAULT NULL
);              
ALTER TABLE PUBLIC.STOREDKEYS ADD CONSTRAINT PUBLIC.CONSTRAINT_5 PRIMARY KEY(ID);             
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.STOREDKEYS;              
CREATE INDEX PUBLIC.CHANNEL_PUB_KEY ON PUBLIC.STOREDKEYS(CHANNEL_PUB_KEY);    
CREATE CACHED TABLE PUBLIC.TRANSACTIONS(
    ID INT DEFAULT (NEXT VALUE FOR PUBLIC.SYSTEM_SEQUENCE_2BDD19A5_AB2A_4EE9_80C6_CAC11CB06099) NOT NULL NULL_TO_DEFAULT SEQUENCE PUBLIC.SYSTEM_SEQUENCE_2BDD19A5_AB2A_4EE9_80C6_CAC11CB06099,
    HASH VARCHAR(500) NOT NULL,
    CHANNEL_PUB_KEY VARCHAR(500) NOT NULL,
    PAYMENT_ID INT DEFAULT NULL,
    DATA MEDIUMBLOB
);              
ALTER TABLE PUBLIC.TRANSACTIONS ADD CONSTRAINT PUBLIC.CONSTRAINT_F PRIMARY KEY(ID);           
-- 6 +/- SELECT COUNT(*) FROM PUBLIC.TRANSACTIONS;            
ALTER TABLE PUBLIC.STOREDKEYS ADD CONSTRAINT PUBLIC.PUB_KEY UNIQUE(PUB_KEY);  
